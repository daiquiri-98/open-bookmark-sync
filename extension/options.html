<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Open Bookmark Sync - Settings</title>
    <style>
        :root {
            --control-h: 35px;
            --space-1: 8px;
            --space-2: 13px; /* ~8 * 1.618 */
            --space-3: 21px; /* ~13 * 1.618 */
            --space-4: 34px; /* ~21 * 1.618 */
            --border-soft: #edf0f5;
            --text: #2f3137;
            --text-muted: #666;
            --panel-bg: #ffffff;
            --header-h: 72px;
            --sidebar-w: 300px;
            --notification-h: 0px; /* dynamic notification bar height */
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 16px;
            background-color: #f5f5f5;
            font-size: 13px;
            line-height: 1.55;
            color: var(--text);
        }

        .container {
            background: white;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            width: 100%;
            margin: 0 auto;
            box-sizing: border-box;
        }

        h1 {
            color: var(--text);
            margin: 0 0 var(--space-2) 0;
            font-size: 22px;
            font-weight: 600;
        }

        h2 {
            color: var(--text);
            font-size: 16px;
            margin: var(--space-3) 0 var(--space-2) 0;
            font-weight: 600;
        }

        h3 {
            color: var(--text);
            font-size: 13px;
            margin: var(--space-2) 0 var(--space-1) 0;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 16px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: var(--text);
        }

        input[type="text"],
        input[type="url"],
        input[type="password"],
        select {
            width: 100%;
            height: var(--control-h);
            padding: 0 10px;
            border: 1px solid #d7dbe2;
            border-radius: 4px;
            font-size: 13px;
            box-sizing: border-box;
        }

        /* Visually downgrade disabled controls */
        input:disabled,
        select:disabled,
        .toggle-eye:disabled {
            background-color: #f1f3f6 !important;
            color: #8a8f98 !important;
            border-color: #e6e9ef !important;
            opacity: 0.55;
            cursor: not-allowed;
        }

        /* Unify number inputs look */
        input[type="number"] {
            width: 100%;
            height: var(--control-h);
            padding: 0 10px;
            border: 1px solid #d7dbe2;
            border-radius: 4px;
            font-size: 13px;
            box-sizing: border-box;
            -moz-appearance: textfield;
        }
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type="text"]:focus,
        input[type="url"]:focus,
        input[type="password"]:focus {
            outline: none;
            border-color: #5F7FFF;
            box-shadow: none;
        }
        /* Keep select focus neutral (no bright accent) */
        select:focus { outline: none; border-color: #d7dbe2; box-shadow: none; }

        .button {
            background-color: #007cba;
            color: white;
            border: none;
            height: var(--control-h);
            padding: 0 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            display: inline-flex; align-items: center; justify-content: center;
        }

        .button:hover {
            background-color: #005a87;
        }

        .button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .button.secondary {
            background-color: #6c757d;
        }

        .button.secondary:hover {
            background-color: #545b62;
        }

        .button.danger {
            background-color: #dc3545;
        }

        .button.danger:hover {
            background-color: #c82333;
        }

        .status {
            padding: 12px;
            border-radius: 4px;
            margin: 16px 0;
            font-weight: 500;
        }

        .status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .help-text { font-size: 13px; color: var(--text-muted); margin-top: 4px; }

        .sections-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 15px; align-items: start; }
        .section { border: 1px solid var(--border-soft); border-radius: 10px; padding: 18px; margin: 0; background: var(--panel-bg); }

        .auth-status {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 12px 0;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .status-indicator.connected {
            background-color: #28a745;
        }

        .status-indicator.disconnected {
            background-color: #dc3545;
        }

        .sync-info {
            font-size: 13px;
            color: #666;
            margin-top: 8px;
        }

        .pre-filled {
            background-color: #f8f9fa;
            color: #495057;
        }

        .hidden {
            display: none;
        }

        .input-row { display:grid; grid-template-columns: 1fr auto; gap:8px; align-items:center; }

        .toggle-eye { background:#eef2f7; color:#333; border:1px solid #e3e7ef; border-radius:4px; height: var(--control-h); padding:0 12px; cursor:pointer; font-size:13px; min-width:64px; display:inline-flex; align-items:center; justify-content:center; }

        .support {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .bmc-link { background-color: #FFDD00; color: #111; border: none; border-radius: 6px; padding: 8px 12px; font-weight: 600; text-decoration: none; display: inline-flex; align-items: center; gap: 6px; }
        .bmc-link:hover { filter: brightness(0.95); }

        /* Floating support button (MV3-safe replacement for BMC widget) */
        .bmc-float {
            position: fixed;
            right: 18px;
            bottom: 18px;
            z-index: 1000;
            background-color: #5F7FFF;
            color: #fff;
            border: none;
            border-radius: 28px;
            padding: 10px 14px;
            font-weight: 600;
            text-decoration: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .bmc-float:hover { filter: brightness(0.95); }

        /* Tabbed layout */
        .tabs { display: flex; gap: 8px; border-bottom: 1px solid #eee; margin-bottom: 0; }
        .tab-btn { background:#f5f7fb; border:1px solid #e3e7ef; border-bottom:none; padding:8px 12px; border-top-left-radius:6px; border-top-right-radius:6px; cursor:pointer; font-weight:600; color:#333; }
        .tab-btn.active { background:#ffffff; color:#111; }
        .tab-btn.danger { background:#dc3545; color:white; border-color:#dc3545; }
        .tab-btn.danger.active { background:#c82333; color:white; }
        .tab-content { border:none; border-radius: 0; background: transparent; }
        .tab-panel { display:none; padding:0; }
        .tab-panel.active { display:block; }

        .sections-grid { display:block; }
        .section { border:1px solid var(--border-soft); border-radius:10px; padding:18px; margin:12px 0; background:#fff; }

        /* Inline row for select + button alignment */
        .inline-row { display:grid; grid-template-columns: 1fr auto; gap:8px; align-items:center; }
        .inline-row select { height: var(--control-h); }
        .inline-row .button { height: var(--control-h); padding: 0 12px; display:inline-flex; align-items:center; }

        /* Collections controls layout */
        .collections-controls {
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 8px;
            align-items: center;
            margin: 8px 0;
        }

        .refresh-section {
            margin: 8px 0;
        }

        .danger-section { margin: 16px 0; padding: 16px; border: 1px solid #dc3545; border-radius: 10px; background-color: #f8d7da; }
        .collections-controls input {
            height: var(--control-h);
            padding: 0 10px;
            border: 1px solid #d7dbe2;
            border-radius: 4px;
            font-size: 13px;
            box-sizing: border-box;
        }

        .sync-settings-container.disabled {
            opacity: 0.5;
            pointer-events: none;
        }

        /* Checkbox row layout */
        .checkbox-row {
            display: flex;
            align-items: center;
            gap: 16px;
            margin: 8px 0;
            flex-wrap: wrap;
        }
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Grid layouts */
        .sync-settings-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }


        /* Collections styling */
        .collections-select {
            min-width: 280px;
            display: none;
        }
        .collections-list {
            border: 1px solid #d7dbe2;
            border-radius: 4px;
            padding: 8px;
            max-height: 240px;
            overflow: auto;
            background: #fff;
        }

        /* Hierarchical collection styling */
        .collection-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 6px;
            margin: 2px 0;
        }
        .collection-item.child {
            margin-left: 20px;
        }
        .collection-item.grandchild {
            margin-left: 40px;
        }
        .collection-checkbox {
            min-width: 16px;
        }
        .collection-checkbox.indeterminate {
            opacity: 0.7;
        }
        .collection-label {
            flex: 1;
            user-select: none;
            cursor: pointer;
        }

        /* Expand/collapse button styling */
        .expand-button {
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 10px;
            color: #666;
            border-radius: 2px;
            transition: all 0.2s ease;
        }
        .expand-button:hover {
            background-color: #f0f0f0;
            color: #333;
        }
        .expand-spacer {
            width: 16px;
            height: 16px;
        }

        /* Sidebar layout (alternative theme) */
        .main { display: block; }
        .sidebar { display: none; }
        .main-content { width: 100%; }

        body.layout-sidebar { padding: 0; background: #f0f2f5; }
        body.layout-sidebar .container {
            max-width: none;
            margin: 0;
            border-radius: 0;
            box-shadow: none;
            padding: 0;
            min-height: 100vh;
            /* push content below fixed header and beta notification */
            padding-top: calc(var(--header-h) + var(--notification-h));
            transition: padding-top 0.35s ease;
        }

        /* When notification is hidden, adjust padding */
        body.notification-hidden .container {
            padding-top: var(--header-h);
        }
        body.layout-sidebar .header {
            padding: 12px 20px;
            border-bottom: 1px solid #e9ecef;
            background: #fff;
            display:flex; align-items:center; justify-content: space-between;
            position: fixed; top: var(--notification-h); left: 0; right: 0; z-index: 200;
            height: var(--header-h);
            box-sizing: border-box;
            transition: top 0.35s ease;
        }
        body.layout-sidebar .main { display: block; }
        body.layout-sidebar .sidebar {
            display: block;
            width: var(--sidebar-w);
            background: #ffffff;
            border-right: 1px solid #e9ecef;
            padding: 24px 16px; /* restore comfortable inner padding */
            box-sizing: border-box; /* keep total width equal to --sidebar-w */
            position: fixed; top: calc(var(--header-h) + var(--notification-h)); left: 0; bottom: 0;
            overflow-y: auto; /* scrolls within available viewport */
        }
        body.layout-sidebar .main-content {
            margin-left: var(--sidebar-w);
            width: calc(100% - var(--sidebar-w)); /* prevent horizontal overflow */
            margin-top: 0; /* flush with header */
            min-width: 0;
            padding: 24px 28px; /* restore breathing room */
            background: #f7f8fb;
            overflow: auto; /* scrolls content, keeps header & sidebar fixed */
            overflow-x: hidden; /* guard against tiny rounding overflow */
            box-sizing: border-box;
            height: calc(100vh - var(--header-h) - var(--notification-h));
        }
        body.layout-sidebar .tabs { display: none; }
        body.layout-sidebar .tab-content .section { margin: 0 0 12px 0; }

        .sidebar-section { margin-bottom: 16px; }
        .sidebar-title { font-size: 12px; font-weight: 600; color: #2f3137; text-transform: uppercase; padding: 8px 10px; }
        .side-link {
            width: 100%;
            text-align: left;
            background: transparent;
            border: none;
            padding: 8px 10px;
            border-radius: 6px;
            cursor: pointer;
            color: #7a828c; /* slightly more muted for inactive */
            font-weight: 400;
            display: block;
        }
        .side-link:hover { background: #f1f3f5; }
        .side-link.active { background: #eef2f7; color: #2f3137; }
        .side-link.danger.active, .side-link.danger { color: #dc3545; }

        /* Softer placeholders */
        input::placeholder,
        textarea::placeholder {
            color: #9aa0a6;
            opacity: 1;
        }

        /* Duplicate management styles */
        .badge {
            background: #007bff;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }
        .duplicate-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            background: #fff;
        }
        .duplicate-group {
            border-bottom: 1px solid #e9ecef;
            padding: 12px;
        }
        .duplicate-group:last-child {
            border-bottom: none;
        }
        .duplicate-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 0;
            border-bottom: 1px solid #f1f3f5;
        }
        .duplicate-item:last-child {
            border-bottom: none;
        }
        .duplicate-item input[type="checkbox"] {
            margin: 0;
        }
        .duplicate-url {
            font-size: 12px;
            color: #6c757d;
            margin-top: 2px;
        }
        .duplicate-location {
            font-size: 11px;
            color: #999;
            margin-top: 2px;
        }

        /* Inline modal for confirmations */
        .inline-modal {
            position: fixed;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 400;
        }
        .inline-modal.visible {
            display: flex;
        }
        .inline-modal-backdrop {
            position: absolute;
            inset: 0;
            background: rgba(15, 23, 42, 0.35);
            backdrop-filter: blur(2px);
        }
        .inline-modal-dialog {
            position: relative;
            background: #ffffff;
            border-radius: 12px;
            width: min(440px, calc(100% - 32px));
            padding: 20px 22px 18px 22px;
            box-shadow: 0 18px 48px rgba(15, 23, 42, 0.18);
            animation: modal-pop 0.24s ease;
        }
        @keyframes modal-pop {
            from { transform: translateY(12px) scale(0.97); opacity: 0; }
            to { transform: translateY(0) scale(1); opacity: 1; }
        }
        .inline-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 12px;
        }
        .inline-modal-header h3 {
            margin: 0;
            font-size: 17px;
            color: #1f2937;
        }
        .inline-modal-body {
            font-size: 14px;
            color: #4b5563;
            line-height: 1.45;
            margin-bottom: 18px;
            white-space: pre-line;
        }
        .inline-modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        .button-icon {
            border: none;
            background: transparent;
            font-size: 20px;
            line-height: 1;
            cursor: pointer;
            color: #9ca3af;
            padding: 2px 4px;
        }
        .button-icon:hover {
            color: #4b5563;
        }
        body.modal-open {
            overflow: hidden;
        }

        /* Children container styling */
        .collection-children {
            transition: all 0.3s ease;
        }
        .collection-children[style*="display: none"] {
            opacity: 0;
            max-height: 0;
            overflow: hidden;
        }

        .button.small {
            padding: 0 16px;
            font-size: 12px;
            white-space: nowrap;
        }

        .support-text { font-size: 14px; color: #444; line-height: 1.6; }

        /* Loading spinner */
        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid var(--btn-primary-bg, var(--accent));
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .button.loading {
            position: relative;
            color: transparent;
        }

        .button.loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 16px;
            height: 16px;
            margin: -8px 0 0 -8px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Progress bar */
        .progress-bar {
            width: 100%;
            height: 4px;
            background-color: #f0f0f0;
            border-radius: 2px;
            overflow: hidden;
            margin: 8px 0;
        }

        .progress-bar-fill {
            height: 100%;
            background-color: #007cba;
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Auth status enhancements */
        .auth-status.checking {
            opacity: 0.7;
        }

        .status-details {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }

        /* Tooltips */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
            line-height: 1.4;
        }

        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* Enhanced error states */
        .error-details {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 4px;
            padding: 12px;
            margin: 8px 0;
            font-size: 13px;
            color: #721c24;
        }

        .error-details summary {
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 8px;
        }

        .error-details ul {
            margin: 8px 0 0 20px;
            padding: 0;
        }

        .warning-icon, .info-icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            margin-right: 6px;
            vertical-align: text-top;
        }

        /* Support page styling */
        .support-section {
            margin: 24px 0;
            padding: 16px 0;
            border-bottom: 1px solid #eee;
        }
        .support-section:last-child {
            border-bottom: none;
        }
        .support-section h3 {
            margin: 0 0 16px 0;
            font-size: 16px;
            color: #333;
        }
        .support-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: flex-start;
        }

        /* Theme-driven button overrides (global) */
        .button {
            background-color: var(--btn-normal-bg) !important;
            color: var(--btn-normal-fg, #111) !important;
            border: 1px solid var(--btn-normal-border, transparent) !important;
            transition: background-color .2s ease, border-color .2s ease, color .2s ease;
        }
        .button:hover { background-color: var(--btn-normal-hover, var(--btn-normal-bg)) !important; }
        .button.secondary {
            background-color: var(--btn-secondary-bg, var(--btn-normal-bg)) !important;
            color: var(--btn-secondary-fg, var(--btn-normal-fg, #111)) !important;
            border-color: var(--btn-secondary-border, var(--btn-normal-border, transparent)) !important;
        }
        .button.secondary:hover { background-color: var(--btn-secondary-hover, var(--btn-secondary-bg)) !important; }
        .button.primary { background-color: var(--btn-primary-bg, var(--accent)) !important; color: var(--btn-primary-fg, #fff) !important; border-color: var(--btn-primary-border, transparent) !important; }
        .button.primary:hover { background-color: var(--btn-primary-hover, var(--accent-hover)) !important; }
        .button.warning { background-color: var(--btn-warning-bg, #f59e0b) !important; color: var(--btn-warning-fg, #fff) !important; }
        .button.warning:hover { background-color: var(--btn-warning-hover, #d97706) !important; }
        .button.danger, .button.critical { background-color: var(--btn-critical-bg, #dc3545) !important; color: var(--btn-critical-fg, #fff) !important; }
        .button.danger:hover, .button.critical:hover { background-color: var(--btn-critical-hover, #c82333) !important; }

        /* Primary header links also follow theme primary color */
        .header-link.primary { background: var(--btn-primary-bg, var(--accent)) !important; color: var(--btn-primary-fg, #fff) !important; border-color: var(--accent-strong) !important; }
        .header-link.primary:hover { background: var(--btn-primary-hover, var(--accent-hover)) !important; }

        /* Header actions */
        .header { display:flex; align-items:center; justify-content: space-between; }
        .header-actions { display:flex; align-items:center; gap:8px; }
        .header-link {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            text-decoration: none;
            color: #333;
            font-weight: 500;
            font-size: 13px;
            transition: all 0.2s ease;
        }
        .header-link:hover {
            background: #e9ecef;
            border-color: #dee2e6;
            transform: translateY(-1px);
        }
        .header-link.primary {
            background: #007cba;
            border-color: #006ba3;
            color: white;
        }
        .header-link.primary:hover {
            background: #006ba3;
            border-color: #005a87;
        }
        /* ---- Theme variables and overrides ---- */
        :root {
            --accent: #007cba; /* default primary */
            --accent-hover: #005a87;
            --accent-strong: #006ba3;
            --danger: #dc3545;
            /* Default button mapping (Original) */
            --btn-normal-bg: #f5f7fb;
            --btn-normal-fg: #333;
            --btn-normal-hover: #e9eef8;
            --btn-primary-bg: var(--accent);
            --btn-primary-fg: #fff;
            --btn-primary-hover: var(--accent-hover);
            --btn-secondary-bg: #e9ecef;
            --btn-secondary-fg: #333;
            --btn-secondary-hover: #dee2e6;
            --btn-critical-bg: #dc3545;
            --btn-critical-fg: #fff;
            --btn-critical-hover: #c82333;
            --btn-warning-bg: #f59e0b;
            --btn-warning-fg: #fff;
            --btn-warning-hover: #d97706;
        }
        /* Modern Minimal Themes - Clean & Contemporary */

        /* Default/Original - Clean Blue */
        [data-theme="default"] {
            --accent: #2563eb;
            --accent-hover: #1d4ed8;
            --accent-strong: #1e40af;
            --btn-normal-bg: #f8fafc;
            --btn-normal-fg: #334155;
            --btn-normal-hover: #f1f5f9;
            --btn-primary-bg: #2563eb;
            --btn-primary-fg: #ffffff;
            --btn-primary-hover: #1d4ed8;
            --btn-secondary-bg: #e2e8f0;
            --btn-secondary-fg: #475569;
            --btn-secondary-hover: #cbd5e1;
        }

        /* Nordic - Cool Scandinavian */
        [data-theme="nordic"] {
            --accent: #5e81ac;
            --accent-hover: #4c566a;
            --accent-strong: #434c5e;
            --btn-normal-bg: #eceff4;
            --btn-normal-fg: #2e3440;
            --btn-normal-hover: #e5e9f0;
            --btn-primary-bg: #5e81ac;
            --btn-primary-fg: #eceff4;
            --btn-primary-hover: #4c566a;
            --btn-secondary-bg: #d8dee9;
            --btn-secondary-fg: #3b4252;
            --btn-secondary-hover: #e5e9f0;
        }

        /* Emerald - Modern Green */
        [data-theme="emerald"] {
            --accent: #059669;
            --accent-hover: #047857;
            --accent-strong: #065f46;
            --btn-normal-bg: #f0fdf4;
            --btn-normal-fg: #14532d;
            --btn-normal-hover: #dcfce7;
            --btn-primary-bg: #059669;
            --btn-primary-fg: #ffffff;
            --btn-primary-hover: #047857;
            --btn-secondary-bg: #bbf7d0;
            --btn-secondary-fg: #166534;
            --btn-secondary-hover: #86efac;
        }

        /* Sunset - Warm Orange */
        [data-theme="sunset"] {
            --accent: #ea580c;
            --accent-hover: #c2410c;
            --accent-strong: #9a3412;
            --btn-normal-bg: #fff7ed;
            --btn-normal-fg: #7c2d12;
            --btn-normal-hover: #fed7aa;
            --btn-primary-bg: #ea580c;
            --btn-primary-fg: #ffffff;
            --btn-primary-hover: #c2410c;
            --btn-secondary-bg: #fed7aa;
            --btn-secondary-fg: #9a3412;
            --btn-secondary-hover: #fdba74;
        }

        /* Lavender - Soft Purple */
        [data-theme="lavender"] {
            --accent: #8b5cf6;
            --accent-hover: #7c3aed;
            --accent-strong: #6d28d9;
            --btn-normal-bg: #faf5ff;
            --btn-normal-fg: #581c87;
            --btn-normal-hover: #f3e8ff;
            --btn-primary-bg: #8b5cf6;
            --btn-primary-fg: #ffffff;
            --btn-primary-hover: #7c3aed;
            --btn-secondary-bg: #ddd6fe;
            --btn-secondary-fg: #6d28d9;
            --btn-secondary-hover: #c4b5fd;
        }

        /* Rose - Elegant Pink */
        [data-theme="rose"] {
            --accent: #e11d48;
            --accent-hover: #be123c;
            --accent-strong: #9f1239;
            --btn-normal-bg: #fff1f2;
            --btn-normal-fg: #881337;
            --btn-normal-hover: #ffe4e6;
            --btn-primary-bg: #e11d48;
            --btn-primary-fg: #ffffff;
            --btn-primary-hover: #be123c;
            --btn-secondary-bg: #fecdd3;
            --btn-secondary-fg: #9f1239;
            --btn-secondary-hover: #fda4af;
        }

        /* Slate - Professional Gray */
        [data-theme="slate"] {
            --accent: #475569;
            --accent-hover: #334155;
            --accent-strong: #1e293b;
            --btn-normal-bg: #f8fafc;
            --btn-normal-fg: #1e293b;
            --btn-normal-hover: #f1f5f9;
            --btn-primary-bg: #475569;
            --btn-primary-fg: #ffffff;
            --btn-primary-hover: #334155;
            --btn-secondary-bg: #e2e8f0;
            --btn-secondary-fg: #475569;
            --btn-secondary-hover: #cbd5e1;
        }

        /* Cyber - Electric Blue */
        [data-theme="cyber"] {
            --accent: #06b6d4;
            --accent-hover: #0891b2;
            --accent-strong: #0e7490;
            --btn-normal-bg: #ecfeff;
            --btn-normal-fg: #164e63;
            --btn-normal-hover: #cffafe;
            --btn-primary-bg: #06b6d4;
            --btn-primary-fg: #ffffff;
            --btn-primary-hover: #0891b2;
            --btn-secondary-bg: #a5f3fc;
            --btn-secondary-fg: #0e7490;
            --btn-secondary-hover: #67e8f9;
        }

        /* Dark mode overrides */
        :root[data-color-mode="dark"] {
            --panel-bg: #1f2937;
            --text: #e5e7eb;
            --text-muted: #9ca3af;
            --border-soft: #374151;
        }
        :root[data-color-mode="dark"] body { background-color: #0f172a; color: var(--text); }
        :root[data-color-mode="dark"] .header { background: #0b1220; border-bottom-color: #374151; }
        :root[data-color-mode="dark"] .sidebar { background: #0b1220; border-right-color: #374151; }
        :root[data-color-mode="dark"] .main-content { background: #111827; }
        :root[data-color-mode="dark"] .header-link { background: #1f2937; border-color: #374151; color: #e5e7eb; }
        :root[data-color-mode="dark"] .header-link:hover { background: #374151; border-color: #4b5563; }
        :root[data-color-mode="dark"] .tab-btn { background: #1f2937; border-color: #374151; color: #e5e7eb; }
        :root[data-color-mode="dark"] .tab-btn.active { background: #111827; color: #ffffff; }
        :root[data-color-mode="dark"] .section { background: var(--panel-bg); border-color: var(--border-soft); }
        :root[data-color-mode="dark"] .help-text { color: var(--text-muted); }
        :root[data-color-mode="dark"] input, :root[data-color-mode="dark"] select, :root[data-color-mode="dark"] .toggle-eye { background-color: #111827; color: #e5e7eb; border-color: #374151 !important; }
        :root[data-color-mode="dark"] .button.secondary { background-color: #4b5563; }
        :root[data-color-mode="dark"] .status.success { background: #16361d; color: #86efac; border-color: #14532d; }
        :root[data-color-mode="dark"] .status.error { background: #3f1d20; color: #fecaca; border-color: #7f1d1d; }
        :root[data-color-mode="dark"] .status.info { background: #112b34; color: #7dd3fc; border-color: #155e75; }

        /* Apply theme accents only to explicitly marked primary actions */
        .button.primary { background-color: var(--accent) !important; }
        .button.primary:hover { background-color: var(--accent-hover) !important; }
        /* Warning variant for attention but non-destructive actions */
        .button.warning { background-color: #f59e0b; color: #fff; }
        .button.warning:hover { background-color: #d97706; }
        .header-link.primary { background: var(--accent); border-color: var(--accent-strong); color: #fff; }
        .header-link.primary:hover { background: var(--accent-strong); border-color: var(--accent-hover); }
        #toggleManagedOAuth, #toggleManualConfig { border-color: var(--accent) !important; color: var(--accent) !important; }
        input[type="text"]:focus,
        input[type="url"]:focus,
        input[type="password"]:focus { border-color: var(--accent) !important; }
        /* Keep section borders as originally designed; do not force accent */
        /* In non-sidebar layout, push content down when notification is visible */
        body:not(.layout-sidebar) .container {
            /* keep side paddings from base .container, only adjust top */
            padding-top: calc(24px + var(--notification-h));
            transition: padding-top 0.35s ease;
        }
    </style>
</head>
<body class="layout-sidebar">
    <!-- Beta Software Notification Bar - Professional Design -->
    <div id="betaNotificationBar" style="
        background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        color: #ffffff;
        padding: 12px 24px;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 2000;
        display: flex;
        align-items: center;
        justify-content: space-between;
        font-size: 14px;
        font-weight: 500;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
    ">
        <div style="display: flex; align-items: center; gap: 12px;">
            <div style="
                width: 32px;
                height: 32px;
                background: rgba(255,255,255,0.2);
                border-radius: 8px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 16px;
            ">⚠️</div>
            <div>
                <div style="font-weight: 600; font-size: 14px; margin-bottom: 2px;">Beta Software Notice</div>
                <div style="font-size: 12px; opacity: 0.9;">Always backup your bookmarks before making changes</div>
            </div>
        </div>
        <div style="display: flex; align-items: center; gap: 12px;">
            <button id="quickBackupBtn" style="
                background: rgba(255,255,255,0.15);
                color: #ffffff;
                border: 1px solid rgba(255,255,255,0.3);
                padding: 8px 16px;
                border-radius: 6px;
                font-size: 12px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.2s ease;
                backdrop-filter: blur(10px);
            "
            onmouseover="this.style.background='rgba(255,255,255,0.25)'"
            onmouseout="this.style.background='rgba(255,255,255,0.15)'"
            title="Create backup now">
                <span style="margin-right: 6px;">💾</span>Backup Now
            </button>
            <button id="closeBetaNotificationBar" style="
                background: none;
                border: none;
                font-size: 18px;
                color: rgba(255,255,255,0.8);
                cursor: pointer;
                padding: 8px;
                border-radius: 4px;
                transition: all 0.2s ease;
                display: flex;
                align-items: center;
                justify-content: center;
            "
            onmouseover="this.style.background='rgba(255,255,255,0.1)'; this.style.color='#ffffff';"
            onmouseout="this.style.background='none'; this.style.color='rgba(255,255,255,0.8)';"
            title="Close notification">×</button>
        </div>
    </div>

    <!-- Alternative Beta Notification Bar - Minimal Design (hidden by default) -->
    <div id="betaNotificationBarAlt" style="
        background: #fef3c7;
        color: #92400e;
        padding: 8px 20px;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 2000;
        display: none;
        align-items: center;
        justify-content: space-between;
        font-size: 13px;
        font-weight: 500;
        border-bottom: 1px solid #fbbf24;
        transition: all 0.3s ease;
    ">
        <div style="display: flex; align-items: center; gap: 8px;">
            <span style="color: #f59e0b;">⚠️</span>
            <span><strong>Beta Software:</strong> Always backup your bookmarks before making changes</span>
        </div>
        <div style="display: flex; align-items: center; gap: 12px;">
            <button id="quickBackupBtnAlt" style="
                background: #f59e0b;
                color: #ffffff;
                border: none;
                padding: 4px 12px;
                border-radius: 4px;
                font-size: 11px;
                font-weight: 600;
                cursor: pointer;
            " title="Create backup now">Backup</button>
            <button id="closeBetaNotificationBarAlt" style="
                background: none;
                border: none;
                font-size: 18px;
                color: #92400e;
                cursor: pointer;
                padding: 2px 6px;
                border-radius: 2px;
            " title="Close notification">×</button>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>Open Bookmark Sync</h1>
            <div class="header-actions">
                <a id="siteLink" class="header-link" href="#" target="_blank" rel="noopener noreferrer">
                    <span>🏠</span>
                    <span>Visit Website</span>
                </a>
                <a href="mailto:dagkan@daiquiri.dev?subject=Raindrop%20Browser%20Sync%20-%20Issue%20Report&body=Hi%2C%0A%0AI%20found%20an%20issue%20with%20the%20Raindrop%20Browser%20Sync%20extension%3A%0A%0A%5BPlease%20describe%20the%20issue%20here%5D%0A%0AThanks%21" class="header-link">
                    <span>📧</span>
                    <span>Report Issues</span>
                </a>
                <a href="https://github.com/sponsors/daiquiri-98" class="header-link primary" target="_blank" rel="noopener noreferrer">
                    <span>💖</span>
                    <span>Sponsor</span>
                </a>
                <a id="bmcLink" class="bmc-link" href="https://buymeacoffee.com/daiquiri" target="_blank" rel="noopener noreferrer">
                    <span>☕</span>
                    <span>Buy me a coffee</span>
                </a>
            </div>
        </div>

        

        <div class="main">
            <nav class="sidebar" aria-label="Sidebar Navigation">
                <div class="sidebar-section">
                    <div class="sidebar-title">Raindrop.io Sync</div>
                    <button class="side-link" data-tab="api">Connect</button>
                    <button class="side-link" data-tab="sync">Sync</button>
                    <button class="side-link" data-tab="guide">Guide</button>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-title">Maintenance</div>
                    <button class="side-link" data-tab="import">Import/Export</button>
                    <button class="side-link" data-tab="backup">Backup & Restore</button>
                    <button class="side-link" data-tab="duplicates">Duplicates</button>
                    <button class="side-link danger" data-tab="danger">Danger Zone ⚠️</button>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-title">Settings</div>
                    <button class="side-link" data-tab="general">General</button>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-title">Resources</div>
                    <button class="side-link" data-tab="support">Support</button>
                    <button class="side-link" data-tab="roadmap">Roadmap</button>
                    <button class="side-link" data-tab="bmc">Buy Me a Coffee</button>
                </div>
            </nav>
            <div class="main-content">
                <div class="tab-content">
        <div id="statusMessage" class="status hidden" style="position: sticky; top: 0; z-index: 5; margin: 0 0 10px 0;"></div>


        <!-- Closeable Privacy Notice -->
        <div id="privacyNotice" class="section" style="border: 1px solid #e8f4f8; background: #f8fcff; margin-bottom: 16px; display: block;">
            <div style="display: flex; align-items: flex-start; justify-content: space-between;">
                <div>
                    <h3 style="margin: 0 0 8px 0; color: #0066cc;">🔒 Privacy & Security</h3>
                    <div class="help-text" style="margin: 0;">
                        <strong>No telemetry or tracking:</strong> This extension does not collect any usage data, analytics, or personal information.
                        All data stays on your device and your chosen sync service (Raindrop.io).
                        Authentication tokens are stored locally in Chrome's secure storage.
                    </div>
                </div>
                <button id="closePrivacyNotice" type="button" style="background: none; border: none; font-size: 18px; color: #666; cursor: pointer; padding: 4px; margin-left: 12px;" title="Close privacy notice">×</button>
            </div>
        </div>

        <div class="section tab-panel active" id="tab-api" data-tab="api">
            <h2>Authentication</h2>

            <div id="authMethodGroup" class="form-group">
                <label for="authMethod">Authentication Method</label>
                <select id="authMethod">
                    <option value="managed" selected>Managed OAuth (Recommended)</option>
                    <option value="manual">Manual Configuration</option>
                </select>
                <div class="help-text">Choose how to authenticate with Raindrop.io. Managed OAuth is safer and easier.</div>
            </div>
            <div id="authStatus" class="auth-status">
                <div id="statusIndicator" class="status-indicator disconnected"></div>
                <span id="authStatusText">Not authenticated</span>
                <div id="statusDetails" class="status-details hidden"></div>
                <div id="authProgress" class="progress-bar hidden">
                    <div id="authProgressFill" class="progress-bar-fill"></div>
                </div>
            </div>
            <div id="authButtons" style="display: flex; gap: 8px; flex-wrap: wrap; align-items: center;">
                <button id="authenticateBtn" class="button">Authenticate with Raindrop</button>
                <button id="testConnection" class="button secondary">Test Connection</button>
                <button id="logout" class="button danger hidden">Logout</button>
            </div>

            <div id="managedOAuthSection" style="margin-top: 16px; padding: 12px; border: 1px solid #e6e9ef; border-radius: 6px; background: #fafbfc;">
                <div id="managedOAuthHeader" style="display: flex; align-items: center; justify-content: space-between;">
                    <div id="managedOAuthTitle">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <h3 style="margin: 0 0 4px 0; font-size: 14px;">Managed OAuth Settings</h3>
                            <div id="workerStatusContainer">
                                <span id="workerStatus" class="help-text"></span>
                            </div>
                        </div>
                        <span class="help-text" style="margin: 0;">Advanced configuration for managed authentication</span>
                    </div>
                    <button id="toggleManagedOAuth" type="button" style="background: none; border: 1px solid #007cba; color: #007cba; padding: 6px 12px; border-radius: 4px; font-size: 12px; cursor: pointer;">
                        Show
                    </button>
                </div>

                <div id="managedOAuthDetails" class="hidden" style="margin-top: 12px;">
                    <div id="baseUrlGroup" class="form-group">
                        <div id="baseUrlLabel" style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                            <label for="managedOAuthBaseUrl" style="margin: 0;">OAuth Service URL</label>
                        </div>
                        <div class="input-row">
                            <input type="url" id="managedOAuthBaseUrl" placeholder="https://rdoauth.daiquiri.dev" class="pre-filled" disabled>
                            <button id="managedBaseEdit" type="button" class="toggle-eye" aria-label="Edit base URL">Edit</button>
                        </div>
                        <div class="help-text">
                            This is the backend authentication service. Visiting it directly shows "not found" - this is normal and expected.
                            Default is locked; click Edit for manual override (beta/testing).
                        </div>
                    </div>
                </div>
            </div>
            <div id="manualConfigSection" style="margin-top: 16px; padding: 12px; border: 1px solid #e6e9ef; border-radius: 6px; background: #fafbfc;">
                <div id="manualConfigHeader" style="display: flex; align-items: center; justify-content: space-between;">
                    <div id="manualConfigTitle">
                        <h3 style="margin: 0 0 4px 0; font-size: 14px;">Manual Configuration</h3>
                        <span class="help-text" style="margin: 0;">For advanced users or direct authentication setup</span>
                    </div>
                    <button id="toggleManualConfig" type="button" style="background: none; border: 1px solid #007cba; color: #007cba; padding: 6px 12px; border-radius: 4px; font-size: 12px; cursor: pointer;">
                        Show
                    </button>
                </div>

                <div id="manualConfigDetails" class="hidden" style="margin-top: 12px;">
                <div id="clientIdGroup" class="form-group">
                    <label for="clientId">Client ID</label>
                    <div class="input-row">
                        <input type="password" id="clientId" placeholder="Enter your Raindrop Client ID">
                        <button id="toggleClientId" type="button" class="toggle-eye" aria-label="Show/Hide">Show</button>
                    </div>
                    <div class="help-text">Stored locally via Chrome storage. Hidden by default for privacy.</div>
                </div>

                <div id="clientSecretGroup" class="form-group">
                    <label for="clientSecret">Client Secret</label>
                    <div class="input-row">
                        <input type="password" id="clientSecret" placeholder="Enter your Raindrop Client Secret">
                        <button id="toggleClientSecret" type="button" class="toggle-eye" aria-label="Show/Hide">Show</button>
                    </div>
                    <div class="help-text">Do not share your client secret.</div>
                </div>

                <div id="redirectUriGroup" class="form-group">
                    <label for="redirectUri">Redirect URI</label>
                    <div class="input-row">
                        <input type="url" id="redirectUri" class="pre-filled" placeholder="Extension identity redirect (auto)">
                        <button id="redirectReset" type="button" class="toggle-eye" aria-label="Reset to default">Reset</button>
                    </div>
                    <div class="help-text">Default is the extension identity URL (auto). You can override this for beta testing; ensure it matches what you registered in Raindrop.</div>
                    <div id="redirectHint" class="help-text" style="margin-top:6px;"></div>
                </div>
                <div id="saveConfigSection" style="margin-top: 16px;">
                    <button id="saveConfig" class="button">Save Configuration</button>
                </div>
                </div>
            </div>

            <div id="debugSection" class="section" style="margin-top:16px;">
                <h3>Debug</h3>
                <div id="debugButtons" style="display:flex; gap:8px; flex-wrap:wrap;">
                    <button id="viewAuthState" class="button secondary" type="button">View Auth State</button>
                    <button id="runHealthCheck" class="button secondary" type="button">Run Health Check</button>
                    <button id="clearTokens" class="button danger" type="button">Clear Tokens</button>
                </div>
                <pre id="authStateOut" style="background:#f8f9fa; border:1px solid #e6e9ef; padding:10px; border-radius:6px; margin-top:8px; max-height:220px; overflow:auto;"></pre>
            </div>
        </div>

        <div class="section tab-panel" id="tab-sync" data-tab="sync">
            <h2>Sync Settings</h2>

            <!-- Raindrop Protection Notice -->
            <div class="section" style="border: 1px solid #10b981; background: #ecfdf5; margin-bottom: 16px; padding: 12px; border-radius: 6px;">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="color: #047857; font-size: 16px;">🛡️</span>
                    <div>
                        <h3 style="margin: 0 0 4px 0; color: #047857; font-size: 14px;">Raindrop Protection Active</h3>
                        <div class="help-text" style="margin: 0; color: #047857;">
                            This extension never deletes bookmarks from Raindrop.io. Your Raindrop collection is always safe.
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="checkbox-row">
                    <label class="checkbox-label">
                        <input type="checkbox" id="syncEnabled">
                        <strong>Enable Raindrop Sync</strong>
                    </label>
                </div>
                <div class="help-text">When disabled, automatic sync stops and manual sync is blocked.</div>
            </div>

            <div id="syncSettings" class="sync-settings-container">
                <div class="sync-info" style="margin-bottom:12px;">
                    <div id="autoSyncInfo">Automatic sync: Every 5 minutes</div>
                    <div id="lastSyncTime">Last sync: Never</div>
                </div>

            <div class="sync-settings-grid">
                <div class="form-group">
                    <label for="syncInterval">Sync interval (minutes)</label>
                    <input type="number" id="syncInterval" min="1" step="1" placeholder="5">
                    <div class="help-text">Minimum 1 minute. Alarm is rescheduled automatically.</div>
                </div>

                <div class="form-group">
                    <label for="rateLimitRpm">Max requests per minute</label>
                    <input type="number" id="rateLimitRpm" min="1" step="1" placeholder="60">
                    <div class="help-text">Used to pace API calls and avoid rate limit (429). Backoff applies automatically.</div>
                </div>
            </div>

            <div class="form-group">
                <label for="syncModeSelect">Sync mode</label>
                <select id="syncModeSelect">
                    <option value="additions_only">Two-way: Additions only</option>
                    <option value="mirror">Two-way: Mirror (add/update, no deletes)</option>
                    <option value="upload_only">One-way: Browser → Raindrop (additions only)</option>
                    <option value="off" selected>One-way: Raindrop → Browser (rebuild)</option>
                </select>
                <div class="help-text">Controls direction and level of reconciliation. Extension never deletes from Raindrop for safety.</div>
            </div>

            <div class="form-group collections-block">
                <label>Collections to import</label>
                <div class="help-text">Choose which Raindrop collections to import.</div>

                <!-- Collection Import Mode Selection -->
                <div style="margin: 12px 0;">
                    <label for="collectionModeSelect" style="display: block; margin-bottom: 6px; font-weight: 600;">Import Mode:</label>
                    <select id="collectionModeSelect" style="width: 100%; height: 35px; padding: 0 10px; border: 1px solid #d7dbe2; border-radius: 4px; font-size: 13px; margin-bottom: 8px;">
                        <option value="topLevel" selected>Top-level only (Recommended - Safer and faster)</option>
                        <option value="custom">Custom selection (Advanced - Choose specific collections)</option>
                        <option value="all">All collections (Import everything including sub-collections)</option>
                    </select>
                    <div id="collectionModeDescription" class="help-text" style="margin-top: 4px;">Import only parent collections, excluding sub-collections. Safer and faster.</div>
                </div>
                <div class="refresh-section">
                    <button id="refreshCollections" class="button secondary" type="button">Refresh Collections & Folders</button>
                </div>
                <!-- Custom Selection Controls (shown only when Custom mode is selected) -->
                <div id="customCollectionControls" style="display: none;">
                    <div class="collections-controls">
                        <input type="text" id="collectionsSearch" placeholder="Search collections" disabled />
                        <button id="selectAllCollections" class="button secondary small" type="button" disabled>Select all</button>
                        <button id="clearCollections" class="button secondary small" type="button" disabled>Clear</button>
                    </div>
                    <div id="collectionsList" class="collections-list"></div>
                </div>
                <div class="help-text">Select specific collections to import. Only available when "Top-level only" is disabled.</div>
            </div>

            <div class="form-group">
                <label for="targetFolderSelect">Target bookmarks folder</label>
                <select id="targetFolderSelect"></select>
                <div class="help-text">Items sync directly under the selected folder (default: Bookmarks Bar).</div>
            </div>

            <h2>Sorting Options</h2>

            <div class="form-group">
                <label for="collectionsSortSelect">Collections order</label>
                <select id="collectionsSortSelect">
                    <option value="alpha_asc">Alphabetical (A → Z)</option>
                    <option value="alpha_desc">Alphabetical (Z → A)</option>
                    <option value="raindrop">Raindrop order (if available)</option>
                    <option value="none">Do not reorder</option>
                </select>
                <div class="help-text">Applies to collection folders at the target root.</div>
            </div>

            <div class="form-group">
                <label for="bookmarksSortSelect">Bookmarks order</label>
                <select id="bookmarksSortSelect">
                    <option value="created_desc">Newest first</option>
                    <option value="created_asc">Oldest first</option>
                    <option value="alpha_asc">Alphabetical (A → Z)</option>
                    <option value="alpha_desc">Alphabetical (Z → A)</option>
                    <option value="domain_asc">Domain (A → Z)</option>
                    <option value="none">Do not reorder</option>
                </select>
                <div class="help-text">Applies to bookmarks inside each collection folder.</div>
            </div>

            <div class="form-group" style="margin-top: 12px;">
                <button id="syncNow" class="button">Sync Now</button>
            </div>
            </div> <!-- end syncSettings container -->
        </div>

        <div class="section tab-panel" id="tab-guide" data-tab="guide">
            <h2>Setup Guide</h2>
            <p class="support-text">Step-by-step guide to set up and configure Raindrop.io synchronization.</p>

            <div class="support-section">
                <h3>🚀 Quick Setup</h3>
                <ol style="margin: 16px 0; padding-left: 20px; line-height: 1.8;">
                    <li><strong>Choose Authentication Method:</strong> Go to Connect tab and select "Managed OAuth" (recommended) or "Manual Configuration"</li>
                    <li><strong>Authenticate:</strong> Click "Authenticate with Raindrop" - no additional setup needed for Managed OAuth</li>
                    <li><strong>Configure Sync Settings:</strong> In the Sync tab, choose your sync mode and interval</li>
                    <li><strong>Select Target Folder:</strong> Choose which browser bookmarks folder to sync to</li>
                    <li><strong>Choose Collections:</strong> Select which Raindrop collections to sync</li>
                    <li><strong>Enable Sync:</strong> Check "Enable Raindrop Sync" to start automatic synchronization</li>
                </ol>
            </div>

            <div class="support-section">
                <h3>💡 Tips for Best Results</h3>
                <ul style="margin: 16px 0; padding-left: 20px; line-height: 1.6;">
                    <li><strong>Authentication:</strong> Use "Managed OAuth" for easier setup - no need to create Raindrop app</li>
                    <li><strong>Safety First:</strong> Start with "One-way: Raindrop → Browser" sync mode (default)</li>
                    <li><strong>Collections:</strong> Use "Top-level only" collections setting initially</li>
                    <li><strong>Testing:</strong> Test with a longer sync interval (15-30 minutes) at first</li>
                    <li><strong>Backup:</strong> Export your bookmarks before making major changes</li>
                    <li><strong>Verification:</strong> Use the "Test Connection" button to verify your setup</li>
                </ul>
            </div>

            <div class="support-section">
                <h3>🔐 Authentication Methods</h3>
                <div style="margin: 16px 0;">
                    <div style="margin-bottom: 12px;">
                        <strong>Managed OAuth (Recommended)</strong> - Easy setup using our secure authentication service. No need to create a Raindrop app or manage secrets.
                    </div>
                    <div style="margin-bottom: 12px;">
                        <strong>Manual Configuration</strong> - For advanced users. Requires creating your own Raindrop app and entering Client ID/Secret manually.
                    </div>
                </div>
            </div>

            <div class="support-section">
                <h3>⚙️ Sync Modes Explained</h3>
                <div style="margin: 16px 0;">
                    <div style="margin-bottom: 12px;">
                        <strong>One-way: Raindrop → Browser (Default)</strong> - Safest option. Downloads Raindrop bookmarks to browser only. Perfect for first-time users.
                    </div>
                    <div style="margin-bottom: 12px;">
                        <strong>Two-way: Additions only</strong> - Safe bi-directional sync. Only adds new bookmarks, never deletes anything.
                    </div>
                    <div style="margin-bottom: 12px;">
                        <strong>Two-way: Mirror</strong> - Bi-directional sync with additions and updates. Never deletes from Raindrop for safety.
                    </div>
                    <div style="margin-bottom: 12px;">
                        <strong>One-way: Browser → Raindrop</strong> - Uploads browser bookmarks to Raindrop only. Good for backing up browser bookmarks.
                    </div>
                </div>
            </div>
        </div>

        <div class="section tab-panel" id="tab-import" data-tab="import">
            <h2>Import & Export</h2>

            <!-- Automatic Backup Status -->
            <div class="form-group">
                <div class="help-text" style="background: #f3f4f6; padding: 12px; border-radius: 6px; margin-bottom: 16px;">
                    💡 <strong>Note:</strong> For backup and restore operations, please use the dedicated <strong>Backup & Restore</strong> tab in the sidebar.
                </div>
            </div>


            <div class="form-group">
                <h3>Export Bookmarks</h3>
                <div style="margin: 12px 0;">
                    <button id="exportBookmarks" class="button secondary" type="button">Export All Bookmarks (JSON)</button>
                    <div class="help-text">Downloads all your bookmarks as a JSON file for backup or transfer.</div>
                </div>
            </div>

            <div class="form-group">
                <h3>Import Bookmarks</h3>
                <div style="margin: 12px 0;">
                    <input type="file" id="importFile" accept=".json,.html,.htm" style="margin-bottom: 8px;" />
                    <button id="importBookmarks" class="button secondary" type="button" disabled>Import Bookmarks</button>
                    <div class="help-text">
                        Supports:
                        <ul style="margin: 8px 0; padding-left: 20px;">
                            <li><strong>JSON:</strong> Chrome/Brave bookmark exports or our backup format</li>
                            <li><strong>HTML:</strong> Standard browser bookmark exports</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <h3>⚠️ Emergency Restore</h3>
                <div style="margin: 12px 0; padding: 12px; border: 1px solid #f59e0b; background: #fffbeb; border-radius: 6px;">
                    <div style="margin-bottom: 8px;">
                        <button id="emergencyRestore" class="button danger" type="button">Emergency Restore (Clear All + Restore)</button>
                    </div>
                    <div class="help-text" style="color: #92400e;">
                        <strong>Use only if bookmarks are corrupted:</strong> This will delete ALL current bookmarks and restore from a backup file.
                        Only use if your bookmarks are in a broken state.
                    </div>
                </div>
            </div>
        </div>

        <div class="section tab-panel" id="tab-general" data-tab="general">
            <h2>General Settings</h2>

            <div class="form-group">
                <h3>Interface Preferences</h3>
                <div style="margin: 16px 0;">
                    <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                        <input type="radio" name="notificationStyle" id="modernNotification" value="modern" checked>
                        <span><strong>Modern Notification Bar</strong> - Professional gradient design with glassmorphism effects</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="radio" name="notificationStyle" id="minimalNotification" value="minimal">
                        <span><strong>Minimal Notification Bar</strong> - Simple yellow warning design</span>
                    </label>
                </div>
                <div style="margin: 12px 0;">
                    <button id="applyNotificationStyle" class="button secondary" type="button">Apply Style</button>
                    <button id="previewNotificationStyle" class="button secondary" type="button">Preview</button>
                </div>
            </div>

            <div class="form-group">
                <h3>Color Theme</h3>
                <div style="margin: 12px 0; display: grid; gap: 8px; max-width: 380px;">
                    <label for="themeSelect">Choose theme</label>
                    <select id="themeSelect">
                        <option value="default">Clean Blue (Default)</option>
                        <option value="nordic">Nordic (Cool Gray)</option>
                        <option value="emerald">Emerald (Modern Green)</option>
                        <option value="sunset">Sunset (Warm Orange)</option>
                        <option value="lavender">Lavender (Soft Purple)</option>
                        <option value="rose">Rose (Elegant Pink)</option>
                        <option value="slate">Slate (Professional)</option>
                        <option value="cyber">Cyber (Electric Blue)</option>
                    </select>
                    <div id="themePreview" class="help-text" style="display:flex; gap:6px; align-items:center; flex-wrap:wrap; margin-top:6px;"></div>
                </div>
                <div style="margin: 12px 0; display:flex; gap:12px; align-items:center; flex-wrap:wrap;">
                    <button id="applyTheme" class="button secondary" type="button">Apply Theme</button>
                    <label style="display:flex; align-items:center; gap:8px;">
                        <input type="checkbox" id="darkModeToggle" />
                        <span>Dark Mode</span>
                    </label>
                    
                </div>
            </div>
        </div>

        <div class="section tab-panel" id="tab-support" data-tab="support">
            <h2>Support</h2>
            <p class="support-text">Quick setup guide and support resources.</p>

            <h3>Quick Setup</h3>
            <ol style="margin: 16px 0; padding-left: 20px;">
                <li><strong>Connect Raindrop.io:</strong> Enter your credentials and authenticate</li>
                <li><strong>Choose Sync Mode:</strong> Pick reconciliation level and set sync interval</li>
                <li><strong>Select Collections:</strong> Choose which collections to sync and target folder</li>
            </ol>

            <h3>Tips</h3>
            <ul style="margin: 16px 0; padding-left: 20px;">
                <li>Use "Test Connection" to verify authentication</li>
                <li>Export JSON backup before making big changes</li>
                <li>Disable sync before clearing all bookmarks</li>
            </ul>

            

            <div class="support-section">
                <h3>Need Help?</h3>
                <div class="support-buttons">
                    <a id="supportPanelSite" class="header-link" href="#" target="_blank" rel="noopener noreferrer">
                        <span>🏠</span>
                        <span>Visit Website</span>
                    </a>
                    <a class="header-link" href="https://github.com/daiquiri-98/open-bookmark-sync" target="_blank" rel="noopener noreferrer">
                        <span>🔗</span>
                        <span>GitHub Repository</span>
                    </a>
                    <a class="header-link" href="https://github.com/daiquiri-98/open-bookmark-sync/blob/main/PRIVACY.md" target="_blank" rel="noopener noreferrer">
                        <span>🔒</span>
                        <span>Privacy Policy</span>
                    </a>
                    <a href="mailto:dagkan@daiquiri.dev?subject=Raindrop%20Browser%20Sync%20-%20Issue%20Report&body=Hi%2C%0A%0AI%20found%20an%20issue%20with%20the%20Raindrop%20Browser%20Sync%20extension%3A%0A%0A%5BPlease%20describe%20the%20issue%20here%5D%0A%0AThanks%21" class="header-link">
                        <span>📧</span>
                        <span>Report Issues</span>
                    </a>
                </div>
            </div>

            <div class="support-section">
                <h3>⭐ Support the Project</h3>
                <div class="support-buttons" style="display: flex; align-items: center; gap: 12px;">
                    <iframe src="https://ghbtns.com/github-btn.html?user=daiquiri-98&repo=open-bookmark-sync&type=sponsor&size=large" frameborder="0" scrolling="0" width="150" height="30" title="GitHub Sponsor" style="height: 30px;"></iframe>
                    <a href="https://buymeacoffee.com/daiquiri" target="_blank" rel="noopener noreferrer" style="background: #FFDD00; color: #000; padding: 6px 12px; border-radius: 6px; text-decoration: none; font-weight: 600; font-size: 14px; display: inline-flex; align-items: center; gap: 6px; height: 18px; box-sizing: border-box;">
                        <span>☕</span>
                        <span>Buy me a coffee</span>
                    </a>
                </div>
                <div class="help-text" style="margin-top: 8px;">Support the development to help improve this extension!</div>
            </div>
        </div>

        <div class="section tab-panel" id="tab-roadmap" data-tab="roadmap">
            <h2>Roadmap</h2>
            <p class="help-text">Planned improvements focusing on safety, clarity, and scalability.</p>

            <h3>Upcoming Features</h3>
            <ul style="margin: 16px 0; padding-left: 20px; line-height: 1.6;">
                <li><strong>Safer Sync:</strong> Dry-run preview, no-delete safe mode, automatic snapshots</li>
                <li><strong>Per-Collection Controls:</strong> Enable/disable collections, custom folder mapping</li>
                <li><strong>Smart Scheduling:</strong> Quiet hours, next sync ETA, quick retry</li>
                <li><strong>Cloud Backends:</strong> S3, Google Drive, OneDrive, Dropbox support</li>
                <li><strong>Enhanced Filtering:</strong> Include/exclude by tag or domain</li>
            </ul>

            <div class="support-section">
                <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                    <a class="header-link" href="https://github.com/daiquiri-98/open-bookmark-sync" target="_blank" rel="noopener noreferrer">
                        <span>🔗</span>
                        <span>GitHub Repository</span>
                    </a>
                    <a class="header-link" href="#" id="openRoadmapRepo" target="_blank" rel="noopener noreferrer">📄 View full ROADMAP.md</a>
                </div>
            </div>
        </div>

        <div class="section tab-panel" id="tab-bmc" data-tab="bmc">
            <h2>Buy Me a Coffee ☕</h2>
            <p class="support-text">If this extension saves you time, a coffee helps me keep improving it. Thank you for your support!</p>
            <div class="support-section">
                <div class="support-buttons">
                    <a id="bmcPanelLink" class="bmc-link" href="https://buymeacoffee.com/daiquiri" target="_blank" rel="noopener noreferrer">
                        <span>☕</span>
                        <span>Buy me a coffee</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- Duplicates Panel -->
        <div class="section tab-panel" id="tab-duplicates" data-tab="duplicates">
            <h2>Duplicate Management</h2>

            <!-- Status Section -->
            <div class="form-group">
                <div id="duplicateStatus" style="padding: 12px; border: 1px solid #e9ecef; border-radius: 6px; background: #f8f9fa; margin-bottom: 16px;">
                    <div id="duplicateStatusText">Click "Scan for Duplicates" to analyze your bookmarks</div>
                </div>
            </div>

            <!-- Main Duplicate Management -->
            <div class="form-group">
                <h3 style="color: #0066cc;">🎯 Duplicate Management</h3>
                <div style="display: grid; gap: 12px; grid-template-columns: 1fr 1fr; margin: 12px 0;">
                    <div>
                        <button id="scanDuplicates" class="button" style="background: #0066cc; width: 100%;" type="button">Scan for Duplicates</button>
                        <div class="help-text" style="font-size: 11px; margin-top: 4px;">Find duplicate bookmarks and folders</div>
                    </div>
                    <div>
                        <button id="cleanUrlParameters" class="button secondary" style="width: 100%;" type="button">Clean URL Parameters</button>
                        <div class="help-text" style="font-size: 11px; margin-top: 4px;">Remove UTM, fbclid tracking parameters</div>
                    </div>
                </div>

                <div style="margin: 12px 0;">
                    <button id="cleanEmptyFolders" class="button secondary" style="width: 100%;" type="button">Clean Empty Folders</button>
                    <div class="help-text">Remove empty bookmark folders to keep your organization clean.</div>
                </div>
                <div id="duplicatePreview" class="hidden" style="margin: 16px 0; padding: 12px; border: 1px solid #e6e9ef; border-radius: 6px; background: #f8f9fa;">
                    <h4 style="color: #333; margin: 0 0 12px 0;">Duplicate Analysis Results</h4>
                    <div id="duplicateResults"></div>
                    <div style="margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap;">
                        <button id="autoCleanupSelected" class="button" type="button" style="background: var(--accent); color: white;">Auto Cleanup All</button>
                        <button id="manualMergeSelected" class="button secondary" type="button">Manual Merge</button>
                        <button id="cancelScan" class="button secondary" type="button">Cancel</button>
                    </div>
                </div>
            </div>

            <!-- Advanced Options -->
            <div class="form-group">
                <h3>Scan Options</h3>
                <div style="margin: 12px 0;">
                    <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                        <input type="checkbox" id="includeSubfolders" checked>
                        <span>Include subfolders in scan</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                        <input type="checkbox" id="exactTitleMatch">
                        <span>Require exact title match for bookmarks</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" id="createBackupBeforeRemoval" checked>
                        <span>Automatically create backup before any changes</span>
                    </label>
                </div>
            </div>
        </div>

        <div class="section tab-panel" id="tab-danger" data-tab="danger">
            <h2 style="color: #dc3545;">⚠️ Danger Zone</h2>
            <p style="color: #721c24; font-weight: 500; margin-bottom: 24px;">
                These operations are destructive and cannot be undone. Use with extreme caution!
            </p>

            <div class="danger-section">
                <h3 style="color: #dc3545; margin: 16px 0 8px 0;">🎯 Smart Cleanup (Recommended)</h3>
                <div style="margin: 12px 0;">
                    <button id="scanDuplicates" class="button" style="background: #0066cc;" type="button">Scan for Duplicates</button>
                    <div class="help-text" style="color: #721c24; margin-top: 4px;">Scan and preview duplicate bookmarks and folders before making any changes. Safe and user-friendly.</div>
                </div>
                <div id="duplicatePreview" class="hidden" style="margin: 16px 0; padding: 12px; border: 1px solid #e6e9ef; border-radius: 6px; background: #f8f9fa;">
                    <h4 style="color: #333; margin: 0 0 12px 0;">Duplicate Analysis Results</h4>
                    <div id="duplicateResults"></div>
                    <div style="margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap;">
                        <button id="autoCleanupSelected" class="button" type="button" style="background: var(--accent); color: white;">Auto Cleanup All</button>
                        <button id="manualMergeSelected" class="button secondary" type="button">Manual Merge</button>
                        <button id="cancelScan" class="button secondary" type="button">Cancel</button>
                    </div>
                </div>
            </div>


            <div class="danger-section">
                <h3 style="color: #dc3545; margin: 16px 0 8px 0;">Nuclear Option</h3>
                <div style="margin: 12px 0;">
                    <button id="clearAllBookmarks" class="button danger" type="button">Clear ALL Bookmarks</button>
                    <div class="help-text" style="color: #721c24; margin-top: 4px;">⚠️ WARNING: This will delete ALL bookmarks in your browser! Backup required before execution.</div>
                </div>
                <div id="clearConfirmation" class="confirmation-section" style="display: none; margin-top: 12px; padding: 16px; background: #f5f5f5; border: 1px solid #dc3545; border-radius: 4px;">
                    <div id="clearSyncWarning" class="status info" style="display:none; margin-top:0;">
                        Raindrop Sync is currently enabled. After clearing, bookmarks may be restored from Raindrop automatically. Consider disabling "Enable Raindrop Sync" above before proceeding.
                    </div>
                    <div style="margin-bottom: 16px;">
                        <div style="font-weight: bold; color: #721c24; margin-bottom: 8px;">📥 Step 1: Download Backup</div>
                        <button id="downloadBackup" class="button secondary" type="button">Download Bookmarks Backup</button>
                    </div>
                    <div style="margin-bottom: 16px;">
                        <div style="font-weight: bold; color: #721c24; margin-bottom: 8px;">⚠️ Step 2: Confirm Deletion</div>
                        <div style="margin-bottom: 6px; color: #721c24;">Type "CLEAR ALL" to confirm:</div>
                        <input type="text" id="clearConfirmText" placeholder="Type CLEAR ALL here" style="width: 100%; padding: 8px; margin-bottom: 8px; box-sizing: border-box;" />
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button id="executeClear" class="button danger" disabled>Execute Clear</button>
                        <button id="cancelClear" class="button secondary">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Backup & Restore Panel -->
        <div class="section tab-panel" id="tab-backup" data-tab="backup">
            <h2>Backup & Restore</h2>
            <p class="help-text">Emergency backup and restore system for bookmark management.</p>

            <!-- Auto Backup History -->
            <div class="form-group">
                <h3>Auto Backup History</h3>
                <div id="autoBackupsList" style="margin: 12px 0; padding: 12px; border: 1px solid #e9ecef; border-radius: 6px; background: #f8f9fa; min-height: 60px;">
                    <div class="help-text">Your automatic backups are stored locally in the browser.</div>
                </div>
                <div style="margin: 12px 0; display: flex; gap: 8px; justify-content: flex-end;">
                    <button id="refreshAutoBackups" class="button secondary" type="button">Refresh</button>
                    <button id="clearOldAutoBackups" class="button secondary" type="button">Clear Old</button>
                </div>
            </div>

            <!-- Manual Backup & Restore -->
            <div class="form-group">
                <h3>Manual Backup & Restore</h3>
                <div style="margin: 12px 0; display: flex; gap: 8px; justify-content: flex-end; flex-wrap: wrap;">
                    <button id="createBackup" class="button primary" type="button">Create Backup</button>
                    <button id="downloadBackupFile" class="button secondary" type="button">Download Backup</button>
                    <button id="restoreFromBackup" class="button secondary" type="button">Restore from File</button>
                </div>
                <input type="file" id="restoreBackupFile" accept=".json" style="display: none;" />
                <div class="help-text">Create manual backup or restore from a previous backup file.</div>
            </div>

            <!-- Emergency Actions -->
            <div class="form-group">
                <h3 style="color: #dc3545;">Emergency Recovery</h3>
                <div style="margin: 12px 0; display: flex; gap: 8px; justify-content: flex-end;">
                    <button id="restoreLastBackup" class="button" style="background: #28a745;" type="button">Restore Latest Auto Backup</button>
                </div>
                <div class="help-text" style="color: #721c24;">Use this if sync operations go wrong and you need to quickly restore your bookmarks.</div>
            </div>
        </div>

        </div> <!-- end tab-content -->
        
        <!-- Inline confirmation modal -->
        <div id="confirmationModal" class="inline-modal hidden" role="dialog" aria-modal="true" aria-labelledby="confirmationTitle" aria-describedby="confirmationMessage">
            <div class="inline-modal-backdrop" data-close="true"></div>
            <div class="inline-modal-dialog">
                <div class="inline-modal-header">
                    <h3 id="confirmationTitle">Confirm</h3>
                    <button id="confirmationClose" class="button-icon" type="button" aria-label="Close">&times;</button>
                </div>
                <div id="confirmationMessage" class="inline-modal-body"></div>
                <div class="inline-modal-actions">
                    <button id="confirmationCancel" class="button secondary" type="button">Cancel</button>
                    <button id="confirmationConfirm" class="button danger" type="button">Confirm</button>
                </div>
            </div>
        </div>

            </div> <!-- end main-content -->
        </div> <!-- end main -->
    </div>

    <script src="oauth.js"></script>
    <script src="options.js"></script>
</body>
</html>
